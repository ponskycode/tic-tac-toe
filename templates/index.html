<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe</title>
    <style>
        .board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-gap: 10px;
        }
        .cell {
            width: 100px;
            height: 100px;
            font-size: 2rem;
            text-align: center;
            line-height: 100px;
            border: 1px solid #000;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Tic Tac Toe</h1>
    <div class="board">
        <div class="cell" id="cell-0" onclick="makeMove(0)"></div>
        <div class="cell" id="cell-1" onclick="makeMove(1)"></div>
        <div class="cell" id="cell-2" onclick="makeMove(2)"></div>
        <div class="cell" id="cell-3" onclick="makeMove(3)"></div>
        <div class="cell" id="cell-4" onclick="makeMove(4)"></div>
        <div class="cell" id="cell-5" onclick="makeMove(5)"></div>
        <div class="cell" id="cell-6" onclick="makeMove(6)"></div>
        <div class="cell" id="cell-7" onclick="makeMove(7)"></div>
        <div class="cell" id="cell-8" onclick="makeMove(8)"></div>
    </div>
    <button onclick="startNewGame()">Start New Game</button>
    <h2>Leaderboard</h2>
    <ul id="leaderboard"></ul>

    <script>
        let board = ['', '', '', '', '', '', '', '', ''];

        function startNewGame() {
            fetch('/new_game', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    board = ['', '', '', '', '', '', '', '', ''];
                    updateBoard();
                    console.log(data.message);
                });
        }

        function makeMove(cellIndex) {
            if (board[cellIndex] === '') {
                board[cellIndex] = 'X';  // Tu zakładamy, że gracz X wykonuje ruch
                updateBoard();
                fetch('/move', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ board: board })
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data.message);
                });
            }
        }

        function updateBoard() {
            for (let i = 0; i < board.length; i++) {
                document.getElementById('cell-' + i).textContent = board[i];
            }
        }

        function loadLeaderboard() {
            fetch('/leaderboard')
                .then(response => response.json())
                .then(data => {
                    const leaderboard = document.getElementById('leaderboard');
                    leaderboard.innerHTML = '';
                    data.forEach(player => {
                        const li = document.createElement('li');
                        li.textContent = `${player.username}: ${player.wins} wins`;
                        leaderboard.appendChild(li);
                    });
                });
        }

        // Na starcie ładujemy tabelę wyników
        loadLeaderboard();
    </script>
</body>
</html>
